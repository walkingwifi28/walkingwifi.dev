---
import githubIcon from "../assets/icons/github-mark.svg";

const siteName = "walkingwifi.dev";
---

<header
    id="main-header"
    class="p-4 sticky top-0 z-50 w-full transition-all duration-500 ease-in-out"
>
    <div
        class="flex mx-auto items-center justify-between gap-6 w-max px-6 py-4 rounded-full bg-white/95 backdrop-blur-lg shadow-md border border-gray-200 transition-all duration-300"
    >
        <a
            href="/"
            class="text-lg font-semibold tracking-wide text-zinc-800 no-underline hover:opacity-70 transition-opacity duration-300"
        >
            {siteName}
        </a>
        <a
            href="https://github.com/walkingwifi28/walkingwifi.dev"
            target="_blank"
            rel="noopener noreferrer"
            class="hover:opacity-70 transition-opacity duration-300"
            aria-label="GitHub Repository"
        >
            <img src={githubIcon.src} alt="GitHub" width="18" height="18" />
        </a>
    </div>
</header>

<script>
    const header = document.getElementById("main-header");

    if (header) {
        const headerHeight = header.offsetHeight;
        const scrollThreshold = 16; // 約1行分のスクロール量
        let scrollAnchor = window.scrollY; // スクロール方向が変わった時の基準点
        let lastScrollY = window.scrollY;
        let scrollDirection = 0; // 1: down, -1: up, 0: initial
        let isHidden = false;

        const hideHeader = () => {
            if (!isHidden) {
                header.classList.add(
                    "opacity-0",
                    "-translate-y-full",
                    "pointer-events-none",
                );
                isHidden = true;
            }
        };

        const showHeader = () => {
            if (isHidden) {
                header.classList.remove(
                    "opacity-0",
                    "-translate-y-full",
                    "pointer-events-none",
                );
                isHidden = false;
            }
        };

        const handleScroll = () => {
            const currentScrollY = window.scrollY;
            const instantDelta = currentScrollY - lastScrollY;
            const newDirection =
                instantDelta > 0 ? 1 : instantDelta < 0 ? -1 : scrollDirection;

            // スクロール方向が変わったら基準点をリセット
            if (newDirection !== scrollDirection && newDirection !== 0) {
                scrollAnchor = lastScrollY;
                scrollDirection = newDirection;
            }

            const cumulativeDelta = currentScrollY - scrollAnchor;

            // ページ上部では常に表示
            if (currentScrollY <= headerHeight) {
                showHeader();
            }
            // 上方向に累積スクロール（scrollThreshold以上）で表示
            else if (cumulativeDelta < -scrollThreshold) {
                showHeader();
            }
            // 下方向にスクロールで隠す（即座に）
            else if (scrollDirection === 1 && currentScrollY > headerHeight) {
                hideHeader();
            }

            lastScrollY = currentScrollY;
        };

        window.addEventListener("scroll", handleScroll);
        // 初期状態をチェック
        handleScroll();
    }
</script>
