---
import Layout from "../layouts/Layout.astro";
import { getBlogs, getBlogDetail } from "../library/blogs";
import CalendarIcon from "../assets/icons/calendar.svg";
import RefreshIcon from "../assets/icons/refresh.svg";
import Tag from "../components/Tag.astro";

// 詳細記事ページの全パスを取得
export function getStaticPaths() {
    const blogs = getBlogs();
    return blogs.map((blog) => ({
        params: {
            blogId: blog.id,
        },
    }));
}

//記事の詳細情報を取得
const { blogId } = Astro.params;
const blog = getBlogDetail(blogId as string);

// ブログが見つからない場合
if (!blog) {
    return Astro.redirect("/404");
}

// 日付フォーマット（YYYY.MM.DD）
const formatDate = (dateString: string): string => {
    const date = new Date(dateString);
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, "0");
    const day = String(date.getDate()).padStart(2, "0");
    return `${year}.${month}.${day}`;
};
---

<Layout title="My first blog with Astro">
    <main class="max-w-6xl mx-auto px-4 py-8">
        <h1
            class="text-3xl font-bold text-[var(--color-text)] mb-4 leading-tight"
        >
            {blog.title}
        </h1>

        <!-- 日付情報 -->
        <div class="flex items-center gap-6 text-zinc-500 text-sm mb-4">
            <!-- 作成日 -->
            <div class="flex items-center gap-1.5">
                <img src={CalendarIcon.src} alt="作成日" />
                <span>{formatDate(blog.createdAt)}</span>
            </div>
            <!-- 更新日 -->
            <div class="flex items-center gap-1.5">
                <img src={RefreshIcon.src} alt="更新日" />
                <span>{formatDate(blog.updatedAt)}</span>
            </div>
        </div>

        <!-- タグ -->
        {
            blog.tag && blog.tag.length > 0 && (
                <div class="flex flex-wrap gap-2 mb-6">
                    {blog.tag.map((t) => (
                        <Tag name={t.name} />
                    ))}
                </div>
            )
        }

        <div class="post mt-8 leading-relaxed" set:html={blog.content} />
    </main>
</Layout>
